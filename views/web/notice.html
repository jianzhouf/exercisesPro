<% include ../layout/header.html %>
<% include ../layout/menus.html %>
<div class="container">
    <ul class="nav nav-tabs">
        <li><a href="/profile">基本信息</a></li>
        <li class="active"><a href="/profile/notice">通知</a></li>
        <li><a href="/profile/message">消息</a></li>
    </ul>
    <div id="notice">
        <table class="table">
            <tbody id="table-content">
            </tbody>
        </table>
        <div class="pagination">
            <a href="#" class="first" data-action="first">&laquo;</a>
            <a href="#" class="previous" data-action="previous">&lsaquo;</a>
            <input type="text" readonly="readonly"/>
            <a href="#" class="next" data-action="next">&rsaquo;</a>
            <a href="#" class="last" data-action="last">&raquo;</a>
        </div>
    </div>
</div>
<script>
    $("#table-content").on("click", ".notice-delete", function () {
        $(this).parents("tr").next().remove();
        $(this).parents("tr").remove();
        return false;

    });
    $("#table-content").on("click", ".toggle-cont", function () {
        $(this).parents("tr").next().toggleClass('hide');
        return false;

    });

    var params = {
        currentPage: 1
    };

    function tableResponse(params, url) {
        $.ajax({
//            type: "post",
            dataType: "json",
            url: url,
            data: params,
            success: function (data) {
                tableInit(data.data, params, parseInt(data.data.length / 10) + 1, url);
            }
        });
    }

    function tableInit(data, params, maxPage, url) {

        var page = params.currentPage;
        if (data.length == 0) {
            $("#table-content").html('<tr><td colspan="3">找不到数据</td></tr>')
        } else {
            $("#table-content").empty();
            var len = (page - 1) * 10 + 10;
            if (len > data.length) {
                len = data.length;
            }
            for (var i = (page - 1) * 10; i < len; i++) {
                $("#table-content").append('<tr data-id="' + data[i].id + '"><td><a href="#" class="toggle-cont">' + data[i].title + '</a></td><td>'
                    + data[i].ago + '</td><td><a href="#" class="notice-delete">删除</a></td></tr><tr class="hide"><td colspan="3">' + data[i].description + '</td></tr>');
            }

            //分页组件
            $('.pagination').jqPagination({
                link_string: '/?page={page_number}',
                max_page: maxPage,
                paged: function (page) {
                    tableResponse({currentPage: page}, url);
                }
            });
        }
    }

    tableResponse(params, "../javascripts/notice.json");


</script>
<% include ../layout/footer.html %>